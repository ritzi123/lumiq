aws emr create-cluster --applications Name=Hadoop Name=Hive Name=Spark Name=Livy --tags 'Project=DataLake' 'Owner=Lumiq' --ec2-attributes '{"KeyName":"clix-lumiq-edl-res","AdditionalSlaveSecurityGroups":["sg-0d1ef1254871ebe43"],"InstanceProfile":"edl-emr-ec2-role","ServiceAccessSecurityGroup":"sg-0e4692f03066b5941","SubnetId":"subnet-0996a37e003f51643","EmrManagedSlaveSecurityGroup":"sg-05098193ff3883171","EmrManagedMasterSecurityGroup":"sg-08ecd1d6a919a5279","AdditionalMasterSecurityGroups":["sg-0d1ef1254871ebe43"]}' --release-label emr-5.27.0 --log-uri 's3n://clix-lumiq-edl-logging/elasticmapreduce/' --instance-groups '[{"InstanceCount":1,"BidPrice":"OnDemandPrice","AutoScalingPolicy":{"Constraints":{"MinCapacity":1,"MaxCapacity":4},"Rules":[{"Action":{"SimpleScalingPolicyConfiguration":{"ScalingAdjustment":1,"CoolDown":120,"AdjustmentType":"CHANGE_IN_CAPACITY"}},"Description":"","Trigger":{"CloudWatchAlarmDefinition":{"MetricName":"ContainerPending","ComparisonOperator":"GREATER_THAN_OR_EQUAL","Statistic":"AVERAGE","Period":300,"Dimensions":[{"Value":"${emr.clusterId}","Key":"JobFlowId"}],"EvaluationPeriods":1,"Unit":"COUNT","Namespace":"AWS/ElasticMapReduce","Threshold":4}},"Name":"scale-out"},{"Action":{"SimpleScalingPolicyConfiguration":{"ScalingAdjustment":-1,"CoolDown":120,"AdjustmentType":"CHANGE_IN_CAPACITY"}},"Description":"","Trigger":{"CloudWatchAlarmDefinition":{"MetricName":"ContainerPending","ComparisonOperator":"LESS_THAN","Statistic":"AVERAGE","Period":300,"Dimensions":[{"Value":"${emr.clusterId}","Key":"JobFlowId"}],"EvaluationPeriods":1,"Unit":"COUNT","Namespace":"AWS/ElasticMapReduce","Threshold":4}},"Name":"scale-in"}]},"EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":32,"VolumeType":"gp2"},"VolumesPerInstance":4}]},"InstanceGroupType":"TASK","InstanceType":"m5.2xlarge","Name":"Task"},{"InstanceCount":1,"AutoScalingPolicy":{"Constraints":{"MinCapacity":1,"MaxCapacity":3},"Rules":[{"Action":{"SimpleScalingPolicyConfiguration":{"ScalingAdjustment":1,"CoolDown":120,"AdjustmentType":"CHANGE_IN_CAPACITY"}},"Description":"","Trigger":{"CloudWatchAlarmDefinition":{"MetricName":"ContainerPending","ComparisonOperator":"GREATER_THAN_OR_EQUAL","Statistic":"AVERAGE","Period":300,"Dimensions":[{"Value":"${emr.clusterId}","Key":"JobFlowId"}],"EvaluationPeriods":1,"Unit":"COUNT","Namespace":"AWS/ElasticMapReduce","Threshold":4}},"Name":"scale-out"},{"Action":{"SimpleScalingPolicyConfiguration":{"ScalingAdjustment":-1,"CoolDown":120,"AdjustmentType":"CHANGE_IN_CAPACITY"}},"Description":"","Trigger":{"CloudWatchAlarmDefinition":{"MetricName":"ContainerPending","ComparisonOperator":"LESS_THAN","Statistic":"AVERAGE","Period":300,"Dimensions":[{"Value":"${emr.clusterId}","Key":"JobFlowId"}],"EvaluationPeriods":1,"Unit":"COUNT","Namespace":"AWS/ElasticMapReduce","Threshold":4}},"Name":"scale-in"}]},"EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":32,"VolumeType":"gp2"},"VolumesPerInstance":2}]},"InstanceGroupType":"CORE","InstanceType":"m5.xlarge","Name":"Core - 2"},{"InstanceCount":1,"EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":32,"VolumeType":"gp2"},"VolumesPerInstance":2}]},"InstanceGroupType":"MASTER","InstanceType":"m5.xlarge","Name":"Master - 1"}]' --configurations '[{"Classification":"livy-conf","Properties":{"livy.spark.deploy-mode":"cluster","livy.impersonation.enabled":"true"}},{"Classification":"core-site","Properties":{"hadoop.proxyuser.livy.groups":"*","hadoop.proxyuser.livy.hosts":"*"}},{"Classification":"hive-site","Properties":{"hive.metastore.client.factory.class":"com.amazonaws.glue.catalog.metastore.AWSGlueDataCatalogHiveClientFactory"}},{"Classification":"spark-hive-site","Properties":{"hive.metastore.client.factory.class":"com.amazonaws.glue.catalog.metastore.AWSGlueDataCatalogHiveClientFactory"}}]' --auto-scaling-role EMR_AutoScaling_DefaultRole --ebs-root-volume-size 50 --service-role edl-emr-role --enable-debugging --name 'EDL-Indexer' --scale-down-behavior TERMINATE_AT_TASK_COMPLETION --region ap-south-1
